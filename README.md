# Co-Deep Project Frontend

`npm start`로 실행됨.

실행 경로 : `cd frontend`

## Co-Deep Project backend

- python 가상환경 실행 `source myenv/bin/activate`
- FastAPI 트래킹 서버 실행 명령: `uvicorn backend.server:app --host 0.0.0.0 --port 8000`
- FastAPI 챗봇 서버 실행 명령: `uvicorn backend.chatbot_server:app --host 0.0.0.0 --port 8001`

## home 브랜치 (가현)
### 변경사항
1. 홈화면에서 챗봇으로 연결되는 링크 추가, 바로가기 문구 살짝 수정
2. '구 다시 선택하기' 버튼이 다른 페이지에서도 보이는 오류 수정
3. 로고 누끼 딴 버전으로 다시 업로드

## 기존과 다른 점
- 원래 서버가 3개였음.<br>
① backend/server.py<br>
② Frontend/co-deep-frontend(Final)/src/seoin/server1.js<br>
③ Frontend/co-deep-frontend(Final)/src/seoin/server2.js <br>
근데 나중에 배포하고 유지보수하기 쉽게 서버를 하나로 합쳐야될 것 같아서 backend/server.py 로 합침

## 앞으로 해야될 것
- 국회의원 페이지 "의안 투표 추적" 부분에서 찬성, 반대, 기권 버튼 누르면 그것에 해당하는 의안들만 나올 수 있도록 하는 것도 좋을 것 같음.
- server.py 서버 로직 바꿔야됨.
- 현재 문제 <br>
① http://localhost:3000 에 접속해서 home 화면이 나타나고 자동적으로 server가 실행이 안됨. 그래서 http://localhost:3000/seoin 이 페이지에 접속했을 때 서버가 작동되기 시작함.<br>
② 근데 "의안 투표 추적"과 "발의 현황 추적" API 를 같은 파일에 넣어놔서 그런지 "의안 투표 추적" 데이터가 다 안 불러와지면 "발의 현황 추적" 데이터도 안 불러와짐. 즉 둘다 '데이터 불러오는 중' 상태가 유지됨. 빨리 빨리 안 불러와짐. 생각보다 데이터 불러오는 데 시간이 오래 걸림.<br>
③ 데이터가 오래 걸려서 chatbot 페이지로 넘어갔더니 "의안 투표 추적"데이터가 다 불러와지고 난 다음에 Post가 처리됨. 하여튼 그래서 그 앞선 데이터들이 다 처리가 안되면 chatbot 기능도 못 씀.<br>
④ 어찌어찌 해서 다시 /seoin 페이지로 넘어가면 또 처음부터 데이터 불러오는 작업을 다시 시작함. 


## 20241124 서버 로직 수정사항 (서인)
- 캐싱 기능 추가: 외부 API 호출 결과를 10분 동안 캐싱하여 동일한 데이터 요청 시 API 호출을 반복하지 않고 캐싱된 데이터를 반환하게 함. => 24시간으로 바꿔야됨.
- 데이터 사전 로드: 서버가 시작될 때 @on_event("startup") 이벤트 핸들러를 통해 특정 데이터를 미리 로드하고 캐싱함으로써 초기 요청 시 지연 시간을 줄임.
- 비동기 처리 도입: async/await를 활용한 비동기 요청 처리로 동시 요청 처리 성능을 높이고, 서버의 응답 속도를 개선.
- 응답 속도 개선: 캐싱된 데이터와 사전 로드된 데이터를 활용해 반복 요청에 대해 더욱 빠르게 응답할 수 있도록 설계함.

## 20241130 챗봇 튜닝 개선

## 20241228 서버 로직 수정사항 (서인)
기존 국회의원 발의법률안 API가 대표발의안만 불러와지는 문제가 있었음. 공동발의법안도 추가하고자 하였으나 API가 input값으로 PUBL_PROPOSER(공동발의자)을 포함하지 않아 이 발의법률안 API를 가지고 해결할 수 없었음.<br>
그리하여 접근할 수 있는 해결방법이 3가지 정도 있었음.<br>
- 해결방법 1 : 의안 투표 데이터 API도 의안 ID 리스트 API를 불러온 후 국회의원 본회의 표결정보 API에 적용하여 기능을 구현했던 것처럼 PUBL_PROPOSER를 입력값으로 가지고 있는 추가적인 API를 가져와 로직을 구현하는 방법 <br>→ 추가적인 API를 찾아봤으나, PUBL_PROPOSER를 입력값으로 가지고 있는 의안정보시스템 API는 존재하지 않았음. ⇒ X
- 해결방법 2 : 두 번의 API 콜을 한다. <br>
  ① 첫 번째 API 콜 : PROPOSER=곽상언 조건으로 대표발의를 가져온다.<br>
  ② 두 번째 API 콜 : AGE=22 (조건 없이) 전체를 가져온 뒤, co_proposer(= PUBL_PROPOSER) 필드 안에 member_name(예: 곽상언)이 들어있는 건만 서버단에서 필터한다.<br>
  ③ 두 집합을 병합하고, BILL_ID 기준으로 중복 제거한다.<br>
  ④ 최종 결과를 캐싱하고 리턴한다.<br>
  → 22대 전체를 불러오는 호출(두 번째 API 콜)로 인해 트래픽이 커질 수 있어 보류. (∵ 이미 의안 투표 데이터를 불러오는 과정에서 많은 트래픽과 시간을 사용하므로)<br>
- 해결방법 3 : 크롤링 (https://www.assembly.go.kr/portal/assm/assmPrpl/prplMst.do?monaCd=FIE6569O&st=22&viewType=CONTBODY&tabId=collabill )<br>
  대한민국 국회 사이트에서 "곽상언"국회의원의 의정활동이 나타난 페이지를 발견하였다.<br>
  따라서 html 구조를 파악한 후에 BeautifulSoup라이브러리를 통해 크롤링을 할 수 있었다. <br><br>하지만 여기에도 단점이 있었는데, <br>
  ∘ 단점 ① : 원래 기존의 대표발의법안은 "제안일자", "제안자", "공동발의자", "의안 번호", "소관위원회"의 데이터로 출력하려고 했었지만 이 페이지에 나와있는 정보에는 "공동발의자","의안번호"가 있지 않아 크롤링할 수 없었다. <br>따라서 그냥 이 부분을 나타내지 않는 걸로 프론트엔드 코드를 과감히 수정하였다. <br>
  ∘ 단점 ② : "제안이유 및 주요정보"를 나타내는 crawl_bill_details함수의 인자값으로 bill_id가 필수적이었지만, 이 링크에서는 bill_id도 나타나지 않았다. <br>따라서 html 코드를 유심히 살펴보던 중 의안명을 나타내는 부분에 상세정보를 볼 수 있는 링크가 같이 첨부돼있는 것을 보고, 그 링크 안에 있는 billId의 쿼리값을 추출하여 해결할 수 있었다. <br>그리하여 "제안이유 및 주요정보"까지 나타낼 수 있게 되었다. <br>⇒ 하지만 이렇게 되니까 뭐가 대표발의안인지, 뭐가 공동발의안인지 표시가 안되는 상황이 생겼다. 그래서 legend를 추가하여 구분하게 했음.

*추가로 수정해야될 부분 : 이거 분명 로컬 터미널 창에서는 "200 ok" 신호가 떠도 웹 화면에서는 "데이터 불러오는 중..."이게 뜸. 이거 고쳐야됨.

## 20241229 '제안이유 및 주요정보' 요약 기능 시작 (가현)
- 원래 summary 브랜치에서 작업중이었는데 여러가지 문제점이 생겨서 공동발의법안 완료된 새 버전으로 다시 시도하는중

## 20241230 의안투표추적, 발의법률추적 요약 기능 추가 완료 (가현)
법률안의 제안이유 및 주요내용이 너무 긺 -> 사용자가 집중해서 읽을 것 같지 않음 -> openai API 사용해서 요약된 내용을 보여주는 기능 추가

### 변경사항
- `summarize_bill_details` 함수 추가해 내용 요약
- 원래의 서버 로직을 사용하니 요약기능 때문에 데이터 로드되는데 너무 오래 걸려서 `AsyncClient` 이용해 **비동기 처리(async)** 사용 -> 여러 법안 내용 동시에 크롤링, gpt api 요청 기다리는 동안 다른 작업 수행 가능하게끔 함 
- 캐싱 구조 개선: 상세 내용, 요약을 함께 저장하는 캐시 모델 `BillCache` 추가
- `crawl_bill_details` 안에 요약 생성하는 코드 추가
- 프론트엔드에서 상세 내용 없애고 요약된 정보만 보이도록 함 (상세정보는 어차피 링크 누르면 연결되니까)
- 투표 데이터와 법안 데이터의 api 응답 구조가 달라서 프론트에서 불러오는 방식을 서로 다르게 함
- (원형차트 컴포넌트 추가) `npm install chart.js react-chartjs-2`


## 20250102 서버 분리 (서인)
- 챗봇, 트래킹 서버 분리 완료.
- 문제점 : 캐시 문제로 인해(추측) 발의 투표 데이터가 로드되지 않음. 챗봇에서 최신 뉴스 데이터가 안 불러와지는 것 같은데, 이건 예전부터 문제였던 사항같음. 팀원들에게 확인 체크 필요함.

## 20250102 챗봇 서버 백엔드 구현 완 (서인)
- "종로구 최신 뉴스에 대해서 알려줘" 도 잘 작동됨
- "탄핵이 뭐야?"도 잘 작동됨
- 